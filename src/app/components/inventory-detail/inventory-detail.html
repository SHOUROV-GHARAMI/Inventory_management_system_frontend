<div class="container mt-4">
  @if (loading) {
    <div class="text-center py-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }

  @if (error) {
    <div class="alert alert-danger">{{ error }}</div>
  }

  @if (inventory && !loading) {
    <!-- Inventory Header -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row">
          <div class="col-md-8">
            <h2 class="card-title">{{ inventory.title }}</h2>
            <p class="text-muted">
              <i class="fas fa-user"></i> {{ inventory.ownerUsername }} | 
              <i class="fas fa-folder"></i> {{ inventory.category }} | 
              <i class="fas fa-calendar"></i> {{ inventory.createdAt | date }}
            </p>
            <p class="mb-0">
              <span class="badge bg-info me-2">
                <i class="fas fa-box"></i> {{ inventory.itemCount }} items
              </span>
              <span class="badge bg-success">
                <i class="fas fa-heart"></i> {{ inventory.likeCount }} likes
              </span>
              @if (inventory.isPublic) {
                <span class="badge bg-primary ms-2">
                  <i class="fas fa-globe"></i> Public
                </span>
              } @else {
                <span class="badge bg-secondary ms-2">
                  <i class="fas fa-lock"></i> Private
                </span>
              }
            </p>
            @if (inventory.tags) {
              <div class="mt-2">
                @for (tag of inventory.tags.split(','); track tag) {
                  <span class="badge bg-light text-dark me-1">{{ tag.trim() }}</span>
                }
              </div>
            }
          </div>
          <div class="col-md-4 text-end">
            @if (inventory.imageUrl) {
              <img [src]="inventory.imageUrl" [alt]="inventory.title" class="img-fluid rounded" style="max-height: 150px;">
            }
            @if (canEdit) {
              <div class="mt-3">
                <a [routerLink]="['/inventories', inventory.id, 'edit']" class="btn btn-sm btn-primary me-2">
                  <i class="fas fa-edit"></i> Edit
                </a>
                <button class="btn btn-sm btn-danger" (click)="deleteInventory()">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'items'" (click)="setActiveTab('items')" style="cursor: pointer;">
          <i class="fas fa-box"></i> Items
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'discussion'" (click)="setActiveTab('discussion')" style="cursor: pointer;">
          <i class="fas fa-comments"></i> Discussion
        </a>
      </li>
      @if (canEdit) {
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')" style="cursor: pointer;">
            <i class="fas fa-cog"></i> Settings
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'customId'" (click)="setActiveTab('customId')" style="cursor: pointer;">
            <i class="fas fa-hashtag"></i> Custom ID
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'access'" (click)="setActiveTab('access')" style="cursor: pointer;">
            <i class="fas fa-users"></i> Access
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'fields'" (click)="setActiveTab('fields')" style="cursor: pointer;">
            <i class="fas fa-list"></i> Custom Fields
          </a>
        </li>
      }
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'stats'" (click)="setActiveTab('stats')" style="cursor: pointer;">
          <i class="fas fa-chart-bar"></i> Statistics
        </a>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
      @if (activeTab === 'items') {
        <app-items-table [inventoryId]="inventory.id" [canEdit]="canEdit"></app-items-table>
      }

      @if (activeTab === 'discussion') {
        <app-discussion [inventoryId]="inventory.id"></app-discussion>
      }

      @if (activeTab === 'settings' && canEdit) {
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">General Settings</h5>
            <div class="mb-3">
              <label class="form-label">Title</label>
              <input type="text" class="form-control" [value]="inventory.title" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Category</label>
              <input type="text" class="form-control" [value]="inventory.category" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="5" [value]="inventory.description" readonly></textarea>
            </div>
            <p class="text-muted">Edit functionality coming soon...</p>
          </div>
        </div>
      }

      @if (activeTab === 'customId' && canEdit) {
        <app-custom-id-config 
          [inventoryId]="inventory.id" 
          [currentFormat]="inventory.customIdFormat || ''"
          [canEdit]="canEdit">
        </app-custom-id-config>
      }

      @if (activeTab === 'access' && canEdit) {
        <app-access-sharing [inventoryId]="inventory.id" [isOwner]="isOwner"></app-access-sharing>
      }

      @if (activeTab === 'fields' && canEdit) {
        <app-custom-fields-editor [inventoryId]="inventory.id"></app-custom-fields-editor>
      }

      @if (activeTab === 'stats') {
        <app-statistics [inventoryId]="inventory.id"></app-statistics>
      }
    </div>
  }
</div>
