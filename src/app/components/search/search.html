<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Search Header -->
      <div class="card mb-4">
        <div class="card-body">
          <h2 class="card-title mb-4">
            <i class="fas fa-search me-2"></i>
            Search
          </h2>

          <!-- Search Input -->
          <div class="input-group input-group-lg mb-3">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search inventories and items..."
              [(ngModel)]="query"
              (keyup.enter)="search()"
              autofocus>
            @if (query) {
              <button class="btn btn-outline-secondary" type="button" (click)="clearSearch()">
                <i class="fas fa-times"></i>
              </button>
            }
            <button class="btn btn-primary" type="button" (click)="search()" [disabled]="searching">
              @if (searching) {
                <span class="spinner-border spinner-border-sm me-2"></span>
              }
              Search
            </button>
          </div>

          <!-- Search Type Filter -->
          <div class="btn-group" role="group">
            <input type="radio" class="btn-check" name="searchType" id="all" value="all" [(ngModel)]="searchType" autocomplete="off" checked>
            <label class="btn btn-outline-primary" for="all">
              <i class="fas fa-layer-group me-1"></i>
              All
            </label>

            <input type="radio" class="btn-check" name="searchType" id="inventories" value="inventories" [(ngModel)]="searchType" autocomplete="off">
            <label class="btn btn-outline-primary" for="inventories">
              <i class="fas fa-folder me-1"></i>
              Inventories
            </label>

            <input type="radio" class="btn-check" name="searchType" id="items" value="items" [(ngModel)]="searchType" autocomplete="off">
            <label class="btn btn-outline-primary" for="items">
              <i class="fas fa-box me-1"></i>
              Items
            </label>
          </div>
        </div>
      </div>

      <!-- Searching State -->
      @if (searching) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Searching...</span>
          </div>
          <h5 class="text-muted">Searching for "{{ query }}"...</h5>
        </div>
      }

      <!-- Search Results -->
      @if (searched && !searching) {
        <!-- Results Summary -->
        <div class="alert alert-info mb-4">
          <i class="fas fa-info-circle me-2"></i>
          Found <strong>{{ results.totalCount }}</strong> result(s) for "<strong>{{ query }}</strong>"
        </div>

        <!-- Inventories Results -->
        @if (results.inventories.length > 0) {
          <div class="mb-4">
            <h4 class="mb-3">
              <i class="fas fa-folder text-primary me-2"></i>
              Inventories ({{ results.inventories.length }})
            </h4>
            <div class="row g-3">
              @for (inventory of results.inventories; track inventory.id) {
                <div class="col-md-6">
                  <div class="card h-100 search-result-card" (click)="navigateToInventory(inventory.id)">
                    <div class="card-body">
                      <h5 class="card-title" [innerHTML]="getHighlightedText(inventory.title)"></h5>
                      <p class="card-text text-muted small" [innerHTML]="getHighlightedText(inventory.description.substring(0, 150))"></p>
                      <div class="d-flex justify-content-between align-items-center mt-3">
                        <div>
                          <span class="badge bg-secondary me-2">{{ inventory.category }}</span>
                          @if (inventory.isPublic) {
                            <span class="badge bg-primary">
                              <i class="fas fa-globe"></i> Public
                            </span>
                          } @else {
                            <span class="badge bg-secondary">
                              <i class="fas fa-lock"></i> Private
                            </span>
                          }
                        </div>
                        <small class="text-muted">
                          <i class="fas fa-box me-1"></i>
                          {{ inventory.itemCount }} items
                        </small>
                      </div>
                      <div class="mt-2">
                        <small class="text-muted">
                          <i class="fas fa-user me-1"></i>
                          {{ inventory.ownerUsername }}
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Items Results -->
        @if (results.items.length > 0) {
          <div class="mb-4">
            <h4 class="mb-3">
              <i class="fas fa-box text-success me-2"></i>
              Items ({{ results.items.length }})
            </h4>
            <div class="list-group">
              @for (item of results.items; track item.id) {
                <a 
                  class="list-group-item list-group-item-action" 
                  (click)="navigateToItem(item.inventoryId)">
                  <div class="d-flex w-100 justify-content-between align-items-center">
                    <div>
                      <h6 class="mb-1" [innerHTML]="getHighlightedText(item.name)"></h6>
                      <small class="text-muted">
                        <i class="fas fa-folder me-1"></i>
                        {{ item.inventoryTitle }}
                      </small>
                    </div>
                    <span class="badge bg-light text-dark">
                      <i class="fas fa-hashtag"></i>
                      {{ item.customId }}
                    </span>
                  </div>
                </a>
              }
            </div>
          </div>
        }

        <!-- No Results -->
        @if (results.totalCount === 0) {
          <div class="text-center py-5">
            <i class="fas fa-search fa-4x text-muted mb-3 opacity-25"></i>
            <h4 class="text-muted">No results found</h4>
            <p class="text-muted">Try different keywords or search all categories</p>
          </div>
        }
      }

      <!-- Initial State -->
      @if (!searched && !searching) {
        <div class="text-center py-5">
          <i class="fas fa-search fa-4x text-muted mb-3 opacity-25"></i>
          <h4 class="text-muted">Start Searching</h4>
          <p class="text-muted">Enter keywords to search inventories and items</p>
          <div class="mt-4">
            <h6 class="text-muted mb-3">Search Tips:</h6>
            <ul class="list-unstyled text-muted small">
              <li><i class="fas fa-check text-success me-2"></i>Use specific keywords for better results</li>
              <li><i class="fas fa-check text-success me-2"></i>Filter by type to narrow results</li>
              <li><i class="fas fa-check text-success me-2"></i>Search works across titles, descriptions, and tags</li>
            </ul>
          </div>
        </div>
      }
    </div>
  </div>
</div>
